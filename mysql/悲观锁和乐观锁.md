### 悲观锁
特征是先获取锁，然后在执行业务，这是因为假定获取锁非常有可能失败，因此必须先取得锁。
“一锁二查三更新”就是经典的悲观锁。悲观锁通常需要数据库本身提供支持，其语句形式是：select ... for update。
当数据库执行以上语句会将select条件满足的行上锁，从而确保只有一个事件能够执行；而当这条语句执行完毕之后，行锁会自动释放。

需要注意的是，mysql会将select for update这条语句扫描到的所有行都上锁，因此务必确保mysql这条语句使用了索引，绝对不能全表扫描。

### 乐观锁
乐观锁是先执行业务，然后在获取锁，它假定获取锁多半能够成功。
乐观锁的实现无需数据库提供支持，它完全有数据逻辑来实现。一般是先获取历史数据，然后执行UPDATE table set field=new_data where field=old_data。

他所依赖的是update操作的原子性，如果update成功，则表明中间没有其他业务操作这条数据，而如果更新失败，则表明这中间有其他业务修改了数据，因此本业务需要回滚。